
{% extends 'header_footer.html' %}


{% load static %}

{% block page_content %}

<div class="body_container">
<div class="container">
  <div class="exercise_form">
    <h3 style="text-align: center">{{instance.exerciseName}}</h3>
       <div class="container" id="tabs">
           <ul class="nav nav-tabs">
           <li class="active"><a data-toggle="tab" id="video0" href="#menu0">Video 1</a></li>
           <li><a data-toggle="tab" id="video1" href="#menu1">Video 2</a></li>
           <li><a data-toggle="tab" id="video2" href="#menu2">Video 3</a></li>
           <li><a data-toggle="tab" id="video3" href="#menu3">Video 4</a></li>
           <li><a data-toggle="tab" id="video4" href="#menu4">Video 5</a></li>
           </ul>
	           <div class="tab-content">
            <div id="menu0" class="tab-pane active">
             </div>
             
            <div id="menu1" class="tab-pane fade">
             </div>
             
            <div id="menu2" class="tab-pane fade">
             </div>
             
           <div id="menu3" class="tab-pane fade">

             </div>
             
            <div id="menu4" class="tab-pane fade">
             </div>
          </div>

  </div>
  <div class="jumbotron exercise_detail">
    <video id="vid_preview" width="400" height="auto" controls>
      <source src="" type="video/mp4">
    </video>

    <div class="col-lg-6" style="float: right;">
      <div class="form-group">
        <label for="description">Description:</label></br>
        <p style="text-align: left">{{instance.exerciseDescription}}</p>
      </div>
    </div>
  </div>
  </br>
   <p class="text-left"> &emsp; &emsp;Tags: {% for tag in instance.exerciseTag.all %}
    <!-- {{tag.tagDescription}} -->
    <a href="http://localhost:8000/viewProfile/?q={{tag.tagDescription}}">{{tag.tagDescription}}</a>
    <!-- {% include "comma.html" %} -->
    {%endfor%}</p>

<div class="col-lg-12">
  {%if instance.exerciseApproved %}
  <h3>Cross referance:</h3>
    {%for crossExercise in quearyset%}
      {%if instance.exerciseId != crossExercise.exerciseId %}
      <div class="col-lg-12">
        <h3><a href="{%url "detail" id=crossExercise.exerciseId %}">{{crossExercise.exerciseName}}</a></h3>
        <p>{{crossExercise.exerciseDescription}}</p>
      </div>
      {%endif%}
    {%endfor%}
  {%endif%}
</div>

</br>
</br>

<div class="">
  <p class="lead text-center">Comment here</p>
  {% if user.is_authenticated  %}
  <form method="post">{% csrf_token %}
    {{comment_form}}
    <button id = "submitComment" type="submit" class="btn btn-default ">Comment</button>
  </form>
  {% else %}
    <div class="create_exercise_perm">
      <p>You have to Login for your comment, <a href="{% url 'signIn' %}">Sign In</a> here</p>
    </div>
  {% endif  %}

  {% for comment in instance.comment_set.all%}
  {% if comment.isParent %}
  <div class="container">
    <blockquote>
      <p>{{comment.CommentContent}}</p>
      <footer>by {{comment.CommentPoster}} at {{comment.CommentTimestamp}}</footer>
      {% for child_comment in comment.children %}
        <blockquote>
          <p>{{child_comment.CommentContent}}</p>
          <footer>by {{child_comment.CommentPoster}} at {{child_comment.CommentTimestamp}}</footer>
        </blockquote>
        {% endfor %}
        {% if user.is_authenticated  %}
        <form method="post">{% csrf_token %}
          {{comment_form}}
          <input type="hidden" name="parent_id" value="{{comment.CommentId}}">
          <button id = "reply" type="submit" class="btn btn-default ">Replay</button>
        </form>
        {% else %}
          <div class="create_exercise_perm">
            <p>You have to Login for your comment, <a href="{% url 'signIn' %}">Sign In</a> here</p>
          </div>
        {% endif  %}

    </blockquote>
  </div>
  {%endif%}
  {% endfor %}
</div>

</div>
</div>
</div>

<script type="text/javascript">
   var tempvideos = {{ videos|safe}};
   var activeTab = 'video0';
   var viewer;
   var current_vid = 0;
   $(document).ready(function () {
   $('#tabs .nav-tabs a').on('click', function(){
     activeTab=$(this).attr('id');
   
     	if (activeTab == 'video0')
   {
	current_vid = 0;
    }
    
    else if (activeTab == 'video1')
    {
 	current_vid = 1;
   }

    
    else if (activeTab == 'video2')
    {
	current_vid = 2;
   }
   
    
    else if (activeTab == 'video3')
    {
	current_vid = 3;
   
   }
   
    
    else if (activeTab == 'video4')
    {
	current_vid = 4;
   
   }
   	setVideoSrc();
    });
	
    });
   	
     function setVideoSrc() {

	if (tempvideos.length >= current_vid+1)
	{ 
	var videoSrc = document.querySelector("video > source");
	var video = document.querySelector("video");
	
	videoSrc.src = tempvideos[current_vid]['url'];
    	video.load();
	}
	else
	{
	var videoSrc = document.querySelector("video > source");
	var video = document.querySelector("video");
	videoSrc.src = "";
	video.load();
	}
   };

 window.onload = function() {
    
    var video = document.querySelector("video"),
        videoSrc = document.querySelector("video > source"),
	activeTab = 'video0';
	current_vid = 0;
    // set video url
    // reference: https://stackoverflow.com/questions/3732562/can-i-use-javascript-to-dynamically-change-a-videos-source
    videoSrc.src = tempvideos[current_vid]['url'];
    video.load();
 
}

</script>
 {% endblock %}
